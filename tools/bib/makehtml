#!/bin/bash

# This script generates a papers web page from the source bibtex file(s):

SOURCEBIB=../../bibtex/weirich.bib
LOCAL=../../content/

# it divides these files up into the following files, using the bibextract
# utility.
#  - journal.bib 
#  - chapters.bib
#  - thesis.bib
#  - conf.bib
#  - unpub.bib
#  - techreport.bib

# The output is created in publications.html and abstracts.html

# Make changes to the files header and footer to adjust the webpage styles.

# The sed script cleanhtml removes/changes some of the output generated by
# bibtex2html.

# Note: When a new category of publications is added, cleanhtml must be
# modified to strip out the filename-prefix so that the abstracts get
# hyperlinked properly:  If the bibtex file is stored in <foo>.bib add the
# line s/<foo>_// to cleanhtml to strip off the <foo> prefix.

# The file style.css must contain appropriate style information.
# It should be located in the appropriate place.

export TMPDIR=.
FLAGS="-s boldtitle -nodoc -d -r -both -nobibsource -nf ps PS -nf pdf PDF -nf projecturl Project"

###### Create source files
bib2bib -c '$type = "ARTICLE"'  $SOURCEBIB > journal.bib
bib2bib -c '$type = "INCOLLECTION"'  $SOURCEBIB > chapters.bib
bib2bib -c '$type = "INPROCEEDINGS"' $SOURCEBIB > conf.bib
bib2bib -c '$type = "UNPUBLISHED"' $SOURCEBIB > unpub.bib
bib2bib -c '$type = "PHDTHESIS"' $SOURCEBIB > thesis.bib
bib2bib -c '$type = "TECHREPORT"' $SOURCEBIB > techreport.bib

###### Header information
touch publications.html
touch abstracts.html
cp publications.html publications.old
cp abstracts.html abstracts.old
cat pubs-header > publications.html
cat pubs-header > abstracts.html

###### Works In progress
# Put them in an table cell 
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> publications.html
echo "<font size=4>Works in Progress</font>" >> publications.html
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> abstracts.html
echo "<font size=4>Works in Progress</font>" >> abstracts.html

# Generate the html from the bibfile
bibtex2html $FLAGS unpub.bib 

# Clean up the resulting html
sed -f ./cleanhtml unpub.html >> publications.html
sed -f ./cleanhtml unpub_abstracts.html >> abstracts.html

# close the cell
echo "</td></tr>" >> publications.html
echo "</td></tr>" >> abstracts.html


###### Conference Publications
# Put them in an table cell 
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> publications.html
echo "<font size=4>Conferences and Workshops</font>" >> publications.html
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> abstracts.html
echo "<font size=4>Conferences and Workshops</font>" >> abstracts.html

# Generate the html from the bibfile
bibtex2html $FLAGS conf.bib 

# Clean up the resulting html
sed -f ./cleanhtml conf.html >> publications.html
sed -f ./cleanhtml conf_abstracts.html >> abstracts.html

# close the cell
echo "</td></tr>" >> publications.html
echo "</td></tr>" >> abstracts.html


###### Journal Publications
# Put them in an table cell 
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> publications.html
echo "<font size=4>Journal Articles</font>" >> publications.html
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> abstracts.html
echo "<font size=4>Journal Articles</font>" >> abstracts.html

# Generate the html from the bibfile
bibtex2html $FLAGS journal.bib 

# Clean up the resulting html
sed -f cleanhtml journal.html >> publications.html
sed -f cleanhtml journal_abstracts.html >> abstracts.html

# close the cell
echo "</td></tr>" >> publications.html
echo "</td></tr>" >> abstracts.html

###### Chapter Publications
# Put them in an table cell 
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> publications.html
echo "<font size=4>Book Chapters</font>" >> publications.html
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> abstracts.html
echo "<font size=4>Journal Articles</font>" >> abstracts.html

# Generate the html from the bibfile
bibtex2html $FLAGS chapters.bib 

# Clean up the resulting html
sed -f cleanhtml chapters.html >> publications.html
sed -f cleanhtml chapters_abstracts.html >> abstracts.html

# close the cell
echo "</td></tr>" >> publications.html
echo "</td></tr>" >> abstracts.html


###### Thesis
# Put them in an table cell 
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> publications.html
echo "<font size=4>Thesis</font>" >> publications.html
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> abstracts.html
echo "<font size=4>Thesis</font>" >> abstracts.html

# Generate the html from the bibfile
bibtex2html -s boldtitle -nodoc -d -r -both -nobibsource -nf ps "PS" -nf pdf "PDF" thesis.bib 

# Clean up the resulting html
sed -f cleanhtml thesis.html >> publications.html
sed -f cleanhtml thesis_abstracts.html >> abstracts.html

# close the cell
echo "</td></tr>" >> publications.html
echo "</td></tr>" >> abstracts.html


###### Technical Reports
# Put them in an table cell 
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> publications.html
echo "<font size=4>Technical Reports</font>" >> publications.html
echo "<tr><td width="100%" class="lightaqua" valign="middle" align="left">" >> abstracts.html
echo "<font size=4>Technical Reports</font>" >> abstracts.html

# Generate the html from the bibfile
bibtex2html $FLAGS techreport.bib 

# Clean up the resulting html
sed -f cleanhtml techreport.html >> publications.html
sed -f cleanhtml techreport_abstracts.html >> abstracts.html

# close the cell
echo "</td></tr>" >> publications.html
echo "</td></tr>" >> abstracts.html


########################################

# Footer information
cat pubs-footer >> publications.html
cat pubs-footer >> abstracts.html

# date information
echo "Last modified: " >> publications.html
date >> publications.html
echo "</font></td></tr></table></table></center></html>" >> publications.html

# date information
echo "Last modified: " >> abstracts.html
date >> abstracts.html
echo "</font></td></tr></table></table></center></html>" >> abstracts.html


## clean up temporary files
rm journal.bib
rm journal.html
rm chapters.bib
rm chapters.html
rm thesis.bib
rm thesis.html
rm conf.bib
rm conf.html
rm unpub.bib
rm unpub.html
rm techreport.bib
rm techreport.html
rm *.old
rm *_abstracts.html

## copy files to local 
cp publications.html $LOCAL
cp abstracts.html $LOCAL
cp weirich.bib $LOCAL
